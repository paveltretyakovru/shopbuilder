// Generated by CoffeeScript 1.9.0
(function() {
  AdminApp.Views.ordersTable = Backbone.View.extend({
    el: '#ordersTableContainer',
    initialize: function() {
    	var lastsel2;

       $("#jqGrid").jqGrid({
                url: '/admin/orders/getorders',
                editurl: '/admin/orders/saveorder',
                mtype: "GET",
                datatype: "json",
                page: 1,             

                colModel: [
                	{label : '#' , name : 'order_id' , key : true , width: 50} ,
					{
						label: 'ФИО',
						name: 'user_fullname',
						width: 170,
					} ,

					{
						label: 'Контактный тел-н',
						name: 'user_phone',
						width: 100,
					} ,

					{
						label: 'Наименование',
						name: 'product_title',
						width: 100,
					} ,

					{
						label: 'Цена',
						name: 'product_price',
						width: 50,
					} ,

					{
						label: 'Оформлен',
						name: 'created_at',
						width: 110
					} ,

					{
						 label: 'Статут',
                         name: 'status',
                         width: 60,
                         editable: true,
                         edittype: "select",
                         editoptions: {
                             value: "checkout:оформлен;confirmed:подтвержден;paid:оплачен"
                         }
                     }
                ],

				loadonce : true,
                viewrecords: true,
                width: 750,
                height: 250,
                rowNum: 20,
                pager: "#jqGridPager" ,

                grouping : true ,
                groupingView : {
                	groupField: ["user_fullname"],
                    groupColumnShow: [true],
                    groupText: ["<b>{0}</b>"],
                    groupOrder: ["asc"],
                    groupSummary: [false],
                    groupCollapse: false
                } ,

                onSelectRow : function(id){
					if(id && id!==lastsel2){
						jQuery('#jqGrid').jqGrid('restoreRow',lastsel2);
						jQuery('#jqGrid').jqGrid('editRow',id,true);
						lastsel2=id;
					}
				}
            });           
    }
  });

  AdminApp.initViews.ordersTable = new AdminApp.Views.ordersTable();

}).call(this);
